---
alwaysApply: true
description: Enforces proper monorepo structure for business logic placement
---

# Monorepo Structure Guidelines

## Keep business logic in `packages/api`

- tRPC routers live under `packages/api/src/routers`.
- Shared server helpers live under `packages/api/src/helpers`.
- Export anything consumed by the frontend through `packages/api/src/index.ts`.

```text
packages/api/src/
├── helpers/        # shared server helpers (env parsing, db helpers, etc.)
├── routers/        # tRPC routers for domains such as repo, org, run…
├── context.ts      # tRPC context definitions
├── trpc.ts         # router factory & procedure helpers
└── index.ts        # public exports
```

## Keep `apps/web` focused on UI

```text
apps/web/src/
├── components/     # React UI, loaders, layout primitives
├── client/         # tRPC client setup
├── hooks/          # UI-centric hooks (polling, theming, etc.)
├── pages/api/      # Thin API routes delegating to tRPC/app logic
├── lib/            # Frontend-only utilities (e.g. `cn` helper)
└── server/         # Astro server helpers (auth, env, db wiring)
```

- Do not place new business logic under `apps/web/src/lib`—instead add a helper in `packages/api` and call it via tRPC.
- API route handlers in `apps/web/src/pages/api` should perform minimal work: validate input, call the corresponding tRPC/router function, and return a response.
- When adding new shared logic, verify whether it belongs in an existing helper or requires a new module inside `packages/api`.
